<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta name="description" content="Verify Trinidax School certificates securely online. Enter your certificate ID (e.g. TRIN-XX-XX) to confirm authenticity of academic records and download official PDFs.">
    <meta name="keywords" content="Trinidax, certificate verification, academic certificate, verify certificate, download certificate, QR code">
    <meta name="author" content="Trinidax School of Computer Studies">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0f172a">
    <title>Verify Certificate | Trinidax School of Computer Studies</title>
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Verify Certificate | Trinidax School">
    <meta property="og:description" content="Securely validate Trinidax academic certificates by entering the certificate ID or scanning the QR code.">
    <meta property="og:image" content="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png">
    <meta property="og:url" content="/">
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Verify Certificate | Trinidax School">
    <meta name="twitter:description" content="Securely validate Trinidax academic certificates by entering the certificate ID or scanning the QR code.">
    <meta name="twitter:image" content="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png">
        <link rel="canonical" href="/">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="referrer" content="no-referrer-when-downgrade">
        <!-- Icons -->
        <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png">
        <meta name="msapplication-TileColor" content="#0f172a">
        <meta name="msapplication-TileImage" content="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png">
        <link rel="manifest" href="/site.webmanifest">
        <!-- Performance hints -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="dns-prefetch" href="https://fonts.googleapis.com">
        <link rel="dns-prefetch" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
        <!-- Additional Open Graph / Twitter enhancements -->
        <meta property="og:locale" content="en_US">
        <meta property="og:site_name" content="Trinidax School">
        <meta property="og:image:alt" content="Trinidax School logo">
        <meta name="twitter:site" content="@Trinidax">

        <!-- Structured Data (JSON-LD) -->
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@graph": [
                {
                    "@type": "Organization",
                    "name": "Trinidax School of Computer Studies",
                    "url": "/",
                    "logo": "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771086267/trinidax.svg_ejrkid.png"
                },
                {
                    "@type": "WebSite",
                    "name": "Trinidax Certificate Verification",
                    "url": "/",
                    "potentialAction": {
                        "@type": "SearchAction",
                        "target": "{search_term_string}",
                        "query-input": "required name=search_term_string"
                    }
                }
            ]
        }
        </script>
    <style>
        :root {
            --primary: #c90d32;
            --dark: #0f172a;
            --success: #22c55e;
            --glass: rgba(255, 255, 255, 0.95);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-image: url('https://res.cloudinary.com/dmrhe3chc/image/upload/v1771073287/Blue_and_Gold_Modern_Participation_Certificate_A4_2_i57osm.png');
            background-size: cover;
            background-repeat: no-repeat;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.404);
            backdrop-filter: blur(8px);
            z-index: -1;
        }

        body::-webkit-scrollbar {
            width: 8px;
        }

        body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        body::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        body::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .container {
            text-align: center;
            background: var(--glass);
            padding: 2rem 1.5rem;
            border-radius: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            border: 1px solid white;
        }

        h1 { color: var(--dark); margin-bottom: 0.5rem; font-size: 1.8rem; }
        p { color: #64748b; margin-bottom: 2rem; }

        .search-box {
            display: flex;
            gap: 10px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: 0.3s;
        }

        .search-box:focus-within { border-color: var(--primary); }
        .search-box.disabled { opacity: 0.6; pointer-events: none; }

        input {
            border: none;
            outline: none;
            flex-grow: 1;
            padding: 10px;
            font-size: 1rem;
            background: transparent;
            min-width: 0;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            white-space: nowrap;
        }
        button:hover { background: #97040b; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .lockout-message {
            margin-top: 1rem;
            color: #b91c1c;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Modal base */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            overflow-y: auto;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            margin: 2rem auto;
            padding: 2rem 1.5rem;
            width: 100%;
            max-width: 800px;
            border-radius: 20px;
            position: relative;
            animation: slideUp 0.4s ease-out;
            text-align: center;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
        }

        .badge {
            display: inline-block;
            background: #dcfce7;
            color: #166534;
            padding: 6px 16px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.8rem;
            margin-bottom: 1rem;
        }

        /* Instruction box */
        .instruction-icon { font-size: 50px; margin-bottom: 15px; display: block; }
        .highlight-id {
            color: var(--primary);
            font-weight: 800;
            background: #fee2e2;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        /* Responsive grid for certificate + QR */
        .cert-grid {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            align-items: center;
        }
        .cert-left { flex: 1; }
        .cert-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .preview-box {
            width: 100%;
            background: #f1f5f9;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            aspect-ratio: 16 / 9;
        }
        .preview-box img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .qr-code {
            width: 100%;
            max-width: 180px;
            height: auto;
            aspect-ratio: 1;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 8px;
            background: white;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .button-group button {
            flex: 1 1 150px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
        }
        .btn-view { background: var(--dark); color: white; }
        .btn-download { background: var(--primary); color: white; }

        /* Warning modal */
        .warning-modal .modal-content { max-width: 450px; }

        /* Responsive breakpoints */
        @media (max-width: 600px) {
            body {
                padding: 0.5rem;
                background-position: center;
                background-repeat: no-repeat;
            }
            .cert-grid {
                flex-direction: column;
                gap: 20px;
            }
            .cert-right {
                width: 100%;
            }
            .qr-code {
                max-width: 150px;
            }
            .modal-content {
                padding: 1.5rem 1rem;
                margin: 1rem auto;
            }
            h1 { font-size: 1.5rem; }
            .button-group button {
                flex: 1 1 100%;
            }
        }

        @media (max-width: 400px) {
            .search-box {
                flex-wrap: wrap;
            }
            .search-box button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <img src="https://res.cloudinary.com/dmrhe3chc/image/upload/v1771003521/logo_lpbscq.png" alt="Trinidax Logo" style="width: 150px; margin-bottom: 1rem;">
    <h1>Certificate Verification</h1>
    <p>Enter your certificate ID below to verify its authenticity and access your official record.</p>
    
    <div class="search-box" id="searchBox">
        <input type="text" id="certInput" placeholder="Enter ID (e.g. TRIN-XX-XX)" onkeypress="if(event.key === 'Enter') checkID()">
        <button onclick="checkID()" id="verifyBtn">Verify</button>
    </div>
    <div id="lockoutMessage" class="lockout-message"></div>
</div>

<!-- Main result modal (instructions / success / error) -->
<div id="resultModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('resultModal')">&times;</span>
        
        <!-- Instruction content (auto popup) -->
        <div id="instructionContent" style="display: none;">
            <span class="instruction-icon">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 70px;" viewBox="0 0 640 640">
                    <path fill="green" d="M568.4 196.5C563.9 207 550 206.3 543.5 196.9C515.7 156.9 477.4 124.7 432.5 104.3C422.1 99.6 418.8 86 428.4 79.7C443.4 69.8 461.4 64 480.7 64C533.3 64 575.9 106.6 575.9 159.2C575.9 172.4 573.2 185 568.3 196.5zM96.5 196.9C90 206.3 76 207 71.6 196.5C66.7 185 64 172.4 64 159.2C64 106.6 106.6 64 159.2 64C178.5 64 196.5 69.8 211.5 79.7C221.1 86 217.8 99.6 207.4 104.3C162.6 124.7 124.3 156.9 96.4 196.9zM454.2 531.4C416.8 559.4 370.3 576 320 576C269.7 576 223.2 559.4 185.9 531.4L150.6 566.6C138.1 579.1 117.8 579.1 105.3 566.6C92.8 554.1 92.8 533.8 105.3 521.3L140.5 486.1C112.6 448.8 96 402.3 96 352C96 228.3 196.3 128 320 128C443.7 128 544 228.3 544 352C544 402.3 527.4 448.8 499.4 486.2L534.6 521.4C547.1 533.9 547.1 554.2 534.6 566.7C522.1 579.2 501.8 579.2 489.3 566.7L454.1 531.5zM344 248C344 234.7 333.3 224 320 224C306.7 224 296 234.7 296 248L296 352C296 358.4 298.5 364.5 303 369L359 425C368.4 434.4 383.6 434.4 392.9 425C402.2 415.6 402.3 400.4 392.9 391.1L343.9 342.1L343.9 248z"/>
                </svg>
            </span>
            <h2 style="color: var(--dark);">How to Find Your Certificate ID</h2>
            <p style="font-size: 1.1rem; line-height: 1.6;">
                Check below the <strong>QR Code</strong> on your physical certificate. 
                You will see a code like <span class="highlight-id">TRIN-XX-XX</span>. 
                Input it in the search box to view your record online and download your official PDF certificate.
            </p>
            <button onclick="closeModal('resultModal')" style="background: var(--dark); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%;">Got it!</button>
        </div>

        <!-- Success content with QR code and two buttons -->
        <div id="successContent" style="display: none;">
            <div class="badge"> <SPan>
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; vertical-align: middle;" viewBox="0 0 640 640" fill="currentColor">
                    <path d="M341.9 38.1C328.5 29.9 311.6 29.9 298.2 38.1C273.8 53 258.7 57 230.1 56.4C214.4 56 199.8 64.5 192.2 78.3C178.5 103.4 167.4 114.5 142.3 128.2C128.5 135.7 120.1 150.4 120.4 166.1C121.1 194.7 117 209.8 102.1 234.2C93.9 247.6 93.9 264.5 102.1 277.9C117 302.3 121 317.4 120.4 346C120 361.7 128.5 376.3 142.3 383.9C164.4 396 175.6 406 187.4 425.4L138.7 522.5C132.8 534.4 137.6 548.8 149.4 554.7L235.4 597.7C246.9 603.4 260.9 599.1 267.1 587.9L319.9 492.8L372.7 587.9C378.9 599.1 392.9 603.5 404.4 597.7L490.4 554.7C502.3 548.8 507.1 534.4 501.1 522.5L452.5 425.3C464.2 405.9 475.5 395.9 497.6 383.8C511.4 376.3 519.8 361.6 519.5 345.9C518.8 317.3 522.9 302.2 537.8 277.8C546 264.4 546 247.5 537.8 234.1C522.9 209.7 518.9 194.6 519.5 166C519.9 150.3 511.4 135.7 497.6 128.1C472.5 114.4 461.4 103.3 447.7 78.2C440.2 64.4 425.5 56 409.8 56.3C381.2 57 366.1 52.9 341.7 38zM320 160C373 160 416 203 416 256C416 309 373 352 320 352C267 352 224 309 224 256C224 203 267 160 320 160z"/>
                </svg>
            </SPan> Verified Certificate</div>
            <h2 id="studentName" style="margin:10px 0;">Student Name</h2>
            <p id="courseName" style="margin:0;">Course Name</p>

            <div class="cert-grid">
                <div class="cert-left">
                    <div class="preview-box">
                        <img id="certPreview" src="" alt="Certificate Preview">
                    </div>
                </div>
                <div class="cert-right">
                    <!-- QR Code image: uses static image if provided in database, otherwise dynamic -->
                    <img id="qrCodeImg" class="qr-code" src="" alt="QR Code">
                    <p style="margin-top: 10px; color: #64748b;">Scan QR code to verify online or download certificate</p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-view" onclick="viewCertificate()">View Certificate</button>
                <button class="btn-download" onclick="downloadCertificate()">Download PDF</button>
            </div>
        </div>

        <!-- Error content -->
        <div id="errorContent" style="display: none;">
            <span style="font-size: 48px; display: block; margin-bottom: 15px;">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 70px;" viewBox="0 0 640 640">
                    <path fill="#e61010" d="M431.2 476.5L163.5 208.8C141.1 240.2 128 278.6 128 320C128 426 214 512 320 512C361.5 512 399.9 498.9 431.2 476.5zM476.5 431.2C498.9 399.8 512 361.4 512 320C512 214 426 128 320 128C278.5 128 240.1 141.1 208.8 163.5L476.5 431.2zM64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576C178.6 576 64 461.4 64 320z"/>
                </svg>
            </span>
            <h2 style="color: #b91c1c;">Certificate Not Found</h2>
            <p id="errorMessage" style="color: #64748b; margin-bottom: 20px;">The ID you entered does not match any record. Please check and try again.
            If you believe this is an error, <a href="#" style="color: var(--primary); text-decoration: underline;">contact support</a> with your certificate details at Trinidax School of Computer Studies. Jalingo Taraba State.</p>
            <button onclick="closeModal('resultModal')" style="background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer;">Try Again</button>
        </div>
    </div>
</div>

<!-- Warning modal (for 3 wrong attempts or lockout) -->
<div id="warningModal" class="modal warning-modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('warningModal')">&times;</span>
        <div style="text-align: center;">
            <span style="font-size: 48px;">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 60px;" viewBox="0 0 640 640">
                    <path fill="#e61010" d="M320 64C334.7 64 348.2 72.1 355.2 85L571.2 485C577.9 497.4 577.6 512.4 570.4 524.5C563.2 536.6 550.1 544 536 544L104 544C89.9 544 76.8 536.6 69.6 524.5C62.4 512.4 62.1 497.4 68.8 485L284.8 85C291.8 72.1 305.3 64 320 64zM320 416C302.3 416 288 430.3 288 448C288 465.7 302.3 480 320 480C337.7 480 352 465.7 352 448C352 430.3 337.7 416 320 416zM320 224C301.8 224 287.3 239.5 288.6 257.7L296 361.7C296.9 374.2 307.4 384 319.9 384C332.5 384 342.9 374.3 343.8 361.7L351.2 257.7C352.5 239.5 338.1 224 319.8 224z"/>
                </svg>
            </span>
            <h2 id="warningTitle" style="color: #b91c1c; margin: 10px 0;">Warning</h2>
            <p id="warningMessage" style="color: #334155; margin-bottom: 20px;"></p>
            <button onclick="closeModal('warningModal')" style="background: var(--primary); color: white; border: none; padding: 10px 30px; border-radius: 8px; font-weight: 600; cursor: pointer;">OK</button>
        </div>
    </div>
</div>

<script>
    // -------------------- DATABASE --------------------
    // Each certificate now has its own unique PDF link.
    // For Google Drive links, we'll automatically extract the file ID
    // to use for viewing (via Google Drive viewer) and downloading.
    const database = {
        "TRIN-26-001": {
            name: "Alfred Godwin",
            course: "Full-Stack Web Engineering",
            preview: "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771073287/Blue_and_Gold_Modern_Participation_Certificate_A4_2_i57osm.png",
            pdf: "https://drive.google.com/file/d/1IjzufUzZOFQfYtbDmPAcL7mIHdlfZ-9W/view?usp=sharing", // Replace with actual unique link
            qr: "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771074770/Afred-qr_fw78bv.png" // optional static QR code URL
        },
        "TRIN-26-002": {
            name: "Emily Chen",
            course: "Data Science & AI",
            preview: "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771073286/Blue_and_Gold_Modern_Participation_Certificate_A4_1_zdjj4c.png",
            pdf: "https://drive.google.com/file/d/1fxNWA8KtlZi9Uz_nKKZZwlq0QA9S2rMM/view?usp=sharing", // different link
            qr: "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771074770/Emily-qr_eazloz.png"
        },
        "TRIN-26-003": {
            name: "Michael Lee",
            course: "Cybersecurity Fundamentals",
            preview: "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771073287/Blue_and_Gold_Modern_Participation_Certificate_A4_xbnjlw.png",
            pdf: "https://drive.google.com/file/d/1i-eS8p5jy2VRjjumn1ZhqVTBY0ykYu83/view?usp=sharing", // different link
            qr: "https://res.cloudinary.com/dmrhe3chc/image/upload/v1771072820/qr_download_xsbz8x.png"
        }
    };

    // Helper to extract Google Drive file ID from various URL formats
    function getGoogleDriveFileId(url) {
        if (!url) return null;
        // Format: https://drive.google.com/file/d/FILE_ID/view?usp=sharing
        const match = url.match(/\/file\/d\/([^\/?]+)/);
        return match ? match[1] : null;
    }

    // -------------------- LOCKOUT STATE --------------------
    let wrongAttempts = parseInt(localStorage.getItem('wrongAttempts')) || 0;
    let firstWrongTime = parseInt(localStorage.getItem('firstWrongTime')) || null;
    const LOCKOUT_LIMIT = 5;
    const LOCKOUT_DURATION = 60 * 60 * 1000; // 1 hour

    function isLocked() {
        if (!firstWrongTime) return false;
        const now = Date.now();
        if (wrongAttempts >= LOCKOUT_LIMIT && (now - firstWrongTime) < LOCKOUT_DURATION) {
            return true;
        } else if ((now - firstWrongTime) >= LOCKOUT_DURATION) {
            resetLockout();
            return false;
        }
        return false;
    }

    function resetLockout() {
        wrongAttempts = 0;
        firstWrongTime = null;
        localStorage.removeItem('wrongAttempts');
        localStorage.removeItem('firstWrongTime');
        updateLockoutUI();
    }

    function incrementWrongAttempts() {
        const now = Date.now();
        if (!firstWrongTime) {
            firstWrongTime = now;
            localStorage.setItem('firstWrongTime', firstWrongTime);
        }
        wrongAttempts++;
        localStorage.setItem('wrongAttempts', wrongAttempts);
        updateLockoutUI();

        if (wrongAttempts === 3) {
            showWarning("You have entered an incorrect ID 3 times. After 5 wrong attempts, you will be locked out for 1 hour.");
        }
    }

    function updateLockoutUI() {
        const input = document.getElementById('certInput');
        const verifyBtn = document.getElementById('verifyBtn');
        const searchBox = document.getElementById('searchBox');
        const lockoutDiv = document.getElementById('lockoutMessage');

        if (isLocked()) {
            input.disabled = true;
            verifyBtn.disabled = true;
            searchBox.classList.add('disabled');

            const remaining = LOCKOUT_DURATION - (Date.now() - firstWrongTime);
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            lockoutDiv.textContent = `Too many failed attempts. Please wait ${minutes}m ${seconds}s before trying again.`;

            if (!window.lockoutInterval) {
                window.lockoutInterval = setInterval(() => {
                    if (isLocked()) {
                        const remaining = LOCKOUT_DURATION - (Date.now() - firstWrongTime);
                        if (remaining <= 0) {
                            clearInterval(window.lockoutInterval);
                            window.lockoutInterval = null;
                            resetLockout();
                            input.disabled = false;
                            verifyBtn.disabled = false;
                            searchBox.classList.remove('disabled');
                            lockoutDiv.textContent = '';
                        } else {
                            const minutes = Math.floor(remaining / 60000);
                            const seconds = Math.floor((remaining % 60000) / 1000);
                            lockoutDiv.textContent = `Too many failed attempts. Please wait ${minutes}m ${seconds}s before trying again.`;
                        }
                    } else {
                        clearInterval(window.lockoutInterval);
                        window.lockoutInterval = null;
                    }
                }, 1000);
            }
        } else {
            input.disabled = false;
            verifyBtn.disabled = false;
            searchBox.classList.remove('disabled');
            lockoutDiv.textContent = '';
            if (window.lockoutInterval) {
                clearInterval(window.lockoutInterval);
                window.lockoutInterval = null;
            }
        }
    }

    // -------------------- MODAL FUNCTIONS --------------------
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
    }

    function showWarning(message) {
        document.getElementById('warningMessage').innerText = message;
        document.getElementById('warningModal').style.display = "block";
    }

    // -------------------- AUTO INSTRUCTION POPUP --------------------
    window.onload = function() {
        let refreshCount = localStorage.getItem('refreshCount') || 0;
        refreshCount++;
        localStorage.setItem('refreshCount', refreshCount);

        if (refreshCount % 2 === 0) {
            setTimeout(showInstructions, 4000);
        }

        updateLockoutUI();

        const urlParams = new URLSearchParams(window.location.search);
        const idFromUrl = urlParams.get('id');
        if (idFromUrl) {
            document.getElementById('certInput').value = idFromUrl;
            checkID();
        }
    };

    function showInstructions() {
        const modal = document.getElementById('resultModal');
        document.getElementById('instructionContent').style.display = 'block';
        document.getElementById('successContent').style.display = 'none';
        document.getElementById('errorContent').style.display = 'none';
        modal.style.display = "block";
    }

    // -------------------- VERIFICATION --------------------
    function checkID() {
        if (isLocked()) {
            showWarning("You are currently locked out due to too many failed attempts. Please wait.");
            return;
        }

        const id = document.getElementById('certInput').value.trim().toUpperCase();
        const modal = document.getElementById('resultModal');
        const instructionDiv = document.getElementById('instructionContent');
        const successDiv = document.getElementById('successContent');
        const errorDiv = document.getElementById('errorContent');

        instructionDiv.style.display = 'none';

        if (database[id]) {
            resetLockout();

            document.getElementById('studentName').innerText = database[id].name;
            document.getElementById('courseName').innerText = database[id].course;
            document.getElementById('certPreview').src = database[id].preview;
            window.currentPdfUrl = database[id].pdf; // store for later use

            // ----- Set the QR code image -----
            const qrImg = document.getElementById('qrCodeImg');
            if (database[id].qr) {
                qrImg.src = database[id].qr;
            } else {
                const baseUrl = window.location.href.split('?')[0];
                const verificationUrl = `${baseUrl}?id=${encodeURIComponent(id)}`;
                qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(verificationUrl)}`;
            }

            successDiv.style.display = 'block';
            errorDiv.style.display = 'none';
        } else {
            incrementWrongAttempts();
            successDiv.style.display = 'none';
            errorDiv.style.display = 'block';
        }
        modal.style.display = "block";
    }

    // -------------------- CERTIFICATE ACTIONS --------------------
    function viewCertificate() {
        if (!window.currentPdfUrl) return;
        const fileId = getGoogleDriveFileId(window.currentPdfUrl);
        if (fileId) {
            // Open in Google Drive viewer
            window.open(`https://drive.google.com/file/d/${fileId}/preview`, '_blank');
        } else {
            // Fallback: open the original URL
            window.open(window.currentPdfUrl, '_blank');
        }
    }

    function downloadCertificate() {
        if (!window.currentPdfUrl) return;
        const fileId = getGoogleDriveFileId(window.currentPdfUrl);
        if (fileId) {
            // Direct download link for Google Drive
            const downloadUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;
            window.open(downloadUrl, '_blank');
        } else {
            // For non-Google Drive URLs, attempt to trigger download via anchor
            const a = document.createElement('a');
            a.href = window.currentPdfUrl;
            a.download = 'certificate.pdf';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    }

    // -------------------- CLICK OUTSIDE MODAL --------------------
    window.onclick = function(event) {
        const modals = ['resultModal', 'warningModal'];
        modals.forEach(id => {
            const modal = document.getElementById(id);
            if (event.target == modal) {
                closeModal(id);
            }
        });
    }
</script>

</body>
</html>